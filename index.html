<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Test MIME-Type Support of your MediaRecorder</title>
    <style>
      body {
        font-family: 'Roboto', sans;
        font-size: 16px;
      }
      h1 {
        font-size: 28px;
      }
      h2 {
        font-size: 24px;
      }
      .icon {
        font-size: 22px;
      }
      table {
        border-collapse: collapse;
      }
      tr:not(:first-child) {
        border-top: 1px solid #bbb;
      }
      td {
        padding: 1px 5px;
      }
    </style>
  </head>
  <body>
    <h1>Test MIME-Type Support of your MediaRecorder</h1>
    <div id="results"></div>
    <script>
      const out = document.getElementById('results');
      const sym = b => b
        ? '<span class="icon" style="color:green;">✔</span>'
        : '<span class="icon" style="color:red;">✘</span>';

      // Base Support
      const isMediaRecorderSupported = typeof MediaRecorder !== 'undefined';
      const isUserCaptureSupported = 'mediaDevices' in navigator
        && 'getUserMedia' in navigator.mediaDevices;
      const isDisplayCaptureSupported = 'mediaDevices' in navigator
        && 'getDisplayMedia' in navigator.mediaDevices;

      const baseOut = `
        <h2>Base support</h2>
        <table>
          <tbody>
            <tr>
              <td>${sym(isMediaRecorderSupported)}</td>
              <td><code>MediaRecorder</code></td>
            </tr>
            <tr>
              <td>${sym(isUserCaptureSupported)}</td>
              <td><code>getUserMedia</code></td>
            </tr>
            <tr>
              <td>${sym(isDisplayCaptureSupported)}</td>
              <td><code>getDisplayMedia</code></td>
            </tr>
          </tbody>
        </table>
      `;

      // MIME Types
      const canCheckMime = isMediaRecorderSupported && 'isTypeSupported' in MediaRecorder;

      let mimeOut;
      if (canCheckMime) {
        let mimeRows = "";
        const mimes = [
          'video/webm',
          'video/webm;codecs="vp9"',
          'video/webm;codecs="vp8"',
          'video/webm;codecs="h264"',
          'video/webm;codecs="avc1"',
          'audio/webm',
          'audio/webm;codecs="opus"',
          'audio/webm;codecs="vorbis"',
          'video/x-matroska',
          'video/x-matroska;codecs="avc1"',
          'video/mp4',
          'video/mp4;codecs="vp9"',
          'video/mp4;codecs="vp8"',
          'video/mp4;codecs="h264"',
          'video/mp4;codecs="avc1"',
        ];

        for (const mime of mimes) {
          const isSupported = MediaRecorder.isTypeSupported(mime);
          mimeRows += `
            <tr>
              <td>${sym(isSupported)}</td>
              <td><code>${mime}</code></td>
            </tr>
          `;
        }

        mimeOut = `
          <h2>MIME-Types</h2>
          (Tested with <code>MediaRecorder.isTypeSupported</code>)
          <br>
          <br>
          <table>
            <tbody>
              ${mimeRows}
            </tbody>
          </table>
        `;
      } else {
        mimeOut = `
          <h2>MIME-Types</h2>
          <code>MediaRecorder.isTypeSupported</code> is not supported by your browser :(
        `;
      }


      out.innerHTML = baseOut + mimeOut;
    </script>
  </body>
</html>
